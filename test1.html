<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>图片预处理提高辨识度</title>
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@2.1.1/dist/tesseract.min.js"></script>
</head>
<body>
    <h1>图片预处理提高辨识度</h1>
    <input type="file" id="image-input" accept="image/*">
    <p>检测到的数字：<span id="detected-number">尚未检测</span></p>
    <canvas id="canvas" style="display:none;"></canvas>

    <script>
        const imageInput = document.getElementById('image-input');
        const detectedNumber = document.getElementById('detected-number');
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        imageInput.addEventListener('change', () => {
            const file = imageInput.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = () => {
                    const img = new Image();
                    img.src = reader.result;

                    img.onload = () => {
                        // 放大图片（提升分辨率）
                        const scale = 2; // 放大倍数
                        canvas.width = img.width * scale;
                        canvas.height = img.height * scale;
                        ctx.drawImage(img, 0, 0, canvas.width, canvas.height);

                        // 灰度化处理
                        const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                        const data = imageData.data;
                        for (let i = 0; i < data.length; i += 4) {
                            const avg = (data[i] + data[i + 1] + data[i + 2]) / 3;
                            data[i] = avg; // Red
                            data[i + 1] = avg; // Green
                            data[i + 2] = avg; // Blue
                        }
                        ctx.putImageData(imageData, 0, 0);

                        // 使用 Tesseract.js 进行 OCR 处理
                        Tesseract.recognize(
                            canvas.toDataURL(),
                            'eng',
                            {
                                logger: info => console.log(info)
                            }
                        ).then(({ data: { text } }) => {
                            const numbers = text.match(/\d+/g);
                            detectedNumber.textContent = numbers ? numbers.join(', ') : "未检测到数字";
                        }).catch(error => {
                            console.error(error);
                            detectedNumber.textContent = "检测失败";
                        });
                    };
                };
                reader.readAsDataURL(file);
            }
        });
    </script>
</body>
</html>
