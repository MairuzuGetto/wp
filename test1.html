<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>图片数字检测</title>
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@2.1.1/dist/tesseract.min.js"></script>
</head>
<body>
    <h1>图片数字检测</h1>
    <p>选择一张图片后，系统会自动检测图片中的数字。</p>

    <input type="file" id="image-input" accept="image/*">
    <p>检测到的数字：<span id="detected-number">尚未检测</span></p>
    <canvas id="canvas" style="display:none;"></canvas>

    <script>
        const imageInput = document.getElementById('image-input');
        const detectedNumber = document.getElementById('detected-number');
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        imageInput.addEventListener('change', () => {
            const file = imageInput.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = () => {
                    const img = new Image();
                    img.src = reader.result;

                    img.onload = () => {
                        // 在 canvas 上绘制图片以供 OCR 处理
                        canvas.width = img.width;
                        canvas.height = img.height;
                        ctx.drawImage(img, 0, 0);

                        // 使用 Tesseract.js 检测文字
                        Tesseract.recognize(
                            canvas.toDataURL(),
                            'eng', // OCR 语言设置为英语（数字属于英语字符集）
                            {
                                logger: info => console.log(info) // 观察 OCR 进度
                            }
                        ).then(({ data: { text } }) => {
                            // 提取检测到的数字
                            const numbers = text.match(/\d+/g); // 使用正则表达式匹配数字
                            detectedNumber.textContent = numbers ? numbers.join(', ') : "未检测到数字";
                        }).catch(error => {
                            console.error(error);
                            detectedNumber.textContent = "检测失败";
                        });
                    };
                };
                reader.readAsDataURL(file);
            }
        });
    </script>
</body>
</html>
