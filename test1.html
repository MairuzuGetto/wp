<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic OCR by Region</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background-color: #f4f4f9;
        }

        h1 {
            text-align: center;
            margin: 20px;
        }

        input[type="file"] {
            margin: 20px;
        }

        #result {
            margin-top: 20px;
            font-size: 1em;
            color: #333;
            background-color: #fff;
            padding: 10px;
            border-radius: 5px;
            max-width: 90%;
            text-align: center;
        }

        canvas {
            max-width: 100%;
            height: auto;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <h1>Dynamic OCR by Region</h1>
    <input type="file" id="imageInput" accept="image/*">
    <div id="result">Upload an image to extract numbers.</div>
    <canvas id="previewCanvas"></canvas>

    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@2.1.1/dist/tesseract.min.js"></script>
    <script>
        const imageInput = document.getElementById('imageInput');
        const resultDiv = document.getElementById('result');
        const previewCanvas = document.getElementById('previewCanvas');
        const ctx = previewCanvas.getContext('2d');

        // Define region rules based on image filenames or criteria
        const regionRules = {
            "image1": [
                { x: 50, y: 50, width: 100, height: 50 },
                { x: 200, y: 100, width: 120, height: 50 },
                { x: 350, y: 150, width: 150, height: 50 },
            ],
            "image2": [
                { x: 100, y: 50, width: 150, height: 60 },
                { x: 300, y: 120, width: 150, height: 60 },
                { x: 500, y: 200, width: 150, height: 60 },
            ]
        };

        imageInput.addEventListener('change', (event) => {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function () {
                const img = new Image();
                img.src = reader.result;

                img.onload = function () {
                    previewCanvas.width = img.width;
                    previewCanvas.height = img.height;
                    ctx.drawImage(img, 0, 0);

                    // Dynamically choose regions based on the file name
                    const regions = regionRules[file.name] || [];
                    if (regions.length === 0) {
                        resultDiv.textContent = "No regions defined for this image.";
                        return;
                    }

                    let finalResult = "";

                    regions.forEach((region, index) => {
                        const croppedCanvas = document.createElement('canvas');
                        croppedCanvas.width = region.width;
                        croppedCanvas.height = region.height;
                        const croppedCtx = croppedCanvas.getContext('2d');
                        croppedCtx.drawImage(
                            img,
                            region.x, region.y, region.width, region.height,
                            0, 0, region.width, region.height
                        );

                        const croppedImageUrl = croppedCanvas.toDataURL();

                        Tesseract.recognize(croppedImageUrl, 'eng', {
                            logger: info => console.log(info)
                        }).then(({ data: { text } }) => {
                            finalResult += `Region ${index + 1}: ${text.trim()}\n`;
                            resultDiv.textContent = finalResult;
                        }).catch(err => {
                            resultDiv.textContent = `Error: ${err.message}`;
                        });

                        // Draw region box on the canvas
                        ctx.strokeStyle = 'red';
                        ctx.lineWidth = 3;
                        ctx.strokeRect(region.x, region.y, region.width, region.height);
                    });
                };
            };
            reader.readAsDataURL(file);
        });
    </script>
</body>
</html>
